/////////////////////////////////////////////////
// 
// JASA EmotionWG 展示会用デモ 定義ファイル
// emotionWG_rapiro_demo.h
// 
/////////////////////////////////////////////////


#include <Servo.h>
#include <Wire.h>
#include <avr/pgmspace.h>

/////////////////////////////////////////////////
// 定数定義
/////////////////////////////////////////////////

/////////////////////////////////////////////////
// 動作
/////////////////////////////////////////////////
#define SHIFT 7
#define R 0          // Red LED
#define G 1          // Green LED
#define B 2          // Blue LED
#define TIME 15      // Column of Time
#define MAXSN 12     // Max Number of Servos
#define MAXMN 11     // Max Number of Motions
#define MAXFN 8      // Max Number of Frames 
#define POWER 17     // Servo power supply control pin
#define ERR -1       // Error
#define SCENARIO_MAX_TIME   (5000)          // １コマンドの時間
#define SERVO_SUSPEND_TIME  (300000)        // Suspendになる時間（msec）

/////////////////////////////////////////////////
// 表情
/////////////////////////////////////////////////
// アドレス
#define  HT_I2C_ADDRESS     (0x70)

// コマンド
#define HT_CMS_DATA         (0x00)
#define HT_CMD_SYSSET       (0x20)
#define HT_CMD_BLINK        (0x80)
#define HT_CMD_BRIGHTNESS   (0xE0)

// System Setup レジスタ設定値
#define HT_SYSSET_OSC_ON    (1)

// Display setup 設定値
#define HT_BLINK_DISPLAY_ON B00000001
#define HT_BLINK_OFF        B00000000
#define HT_BLINK_2HZ        B00000010
#define HT_BLINK_1HZ        B00000100
#define HT_BLINK_05HZ       B00000110

// EYE番号
enum {
    EYE_LEFT,
    EYE_RIGHT,
    EYE_MAX
};

// まばたき状態
enum {
    BLINK_INIT,
    BLINK_WAIT,
    BLINK_OFF
};

// 表情
enum {
    EMO_NORMAL,         // 真顔
    EMO_HEART,          // ハート
    EMO_ANGER,          // 怒
    EMO_SADNESS,        // 哀
    EMO_HAPPINESS,      // 楽
    EMO_SURPRISE,       // 驚
    EMO_SLEEP1,         // 睡眠
    EMO_SLEEP2,         // 睡眠Zzz
    EMO_BLINK,          // まばたき
    EMO_MAX
};

#define TITLE_LOGO_MOJI_NUM         (18)
#define SCROLL_DELAY                (75)
#define EYES_BLINK_TIME             (200)
#define EYES_BLINK_INTERVAL_TIME    (10000)

// JASA EmotionWG 文字列
#if 0
const PROGMEM uint8_t jasaStr[TITLE_LOGO_MOJI_NUM * 8] = {
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x20,0x40,0x42,0x42,0x3E,0x00,0x00,    // J
                                  0x00,0x7C,0x12,0x12,0x12,0x7C,0x00,0x00,    // A
                                  0x00,0x24,0x4A,0x4A,0x4A,0x30,0x00,0x00,    // S
                                  0x00,0x7C,0x12,0x12,0x12,0x7C,0x00,0x00,    // A
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x7E,0x4A,0x4A,0x4A,0x42,0x00,0x00,    // E
                                  0x7C,0x04,0x04,0x7C,0x04,0x04,0x78,0x00,    // m
                                  0x00,0x38,0x44,0x44,0x44,0x38,0x00,0x00,    // o
                                  0x00,0x04,0x04,0x3E,0x44,0x44,0x00,0x00,    // t
                                  0x00,0x40,0x45,0x7D,0x40,0x40,0x00,0x00,    // i
                                  0x00,0x38,0x44,0x44,0x44,0x38,0x00,0x00,    // o
                                  0x04,0x78,0x04,0x04,0x04,0x78,0x00,0x00,    // n
                                  0x00,0x1E,0x60,0x18,0x60,0x1E,0x00,0x00,    // W
                                  0x00,0x3C,0x42,0x42,0x4A,0x78,0x00,0x00};   // G
#else
const PROGMEM uint8_t jasaStr[TITLE_LOGO_MOJI_NUM * 8] = {
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x20,0x40,0x42,0x42,0x3E,0x00,0x00,    // J
                                  0x00,0x7C,0x12,0x12,0x12,0x7C,0x00,0x00,    // A
                                  0x00,0x24,0x4A,0x4A,0x4A,0x30,0x00,0x00,    // S
                                  0x00,0x7C,0x12,0x12,0x12,0x7C,0x00,0x00,    // A
                                  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    //
                                  0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00,    // S
                                  0x00,0x7C,0x04,0x7C,0x04,0x78,0x00,0x00,    // m
                                  0x00,0x20,0x54,0x54,0x54,0x78,0x00,0x00,    // a
                                  0x00,0x04,0x78,0x04,0x04,0x08,0x00,0x00,    // r
                                  0x00,0x00,0x04,0x3F,0x44,0x44,0x00,0x00,    // t
                                  0x00,0x7F,0x40,0x40,0x40,0x40,0x00,0x00,    // L
                                  0x00,0x00,0x44,0x7D,0x40,0x00,0x00,0x00,    // i
                                  0x00,0x00,0x04,0x7E,0x05,0x01,0x00,0x00,    // f
                                  0x00,0x38,0x54,0x54,0x54,0x58,0x00,0x00,    // e
                                  0x00,0x3F,0x40,0x38,0x40,0x3F,0x00,0x00,    // W
                                  0x00,0x3E,0x41,0x49,0x49,0x7A,0x00,0x00};   // G
#endif


//Servos
//  0.Head yaw
//  1.Waist yaw
//  2.R Sholder roll
//  3.R Sholder pitch
//  4.R Hand grip
//  5.L Sholder roll
//  6.L Sholder pitch
//  7.L Hand grip
//  8.R Foot yaw
//  9.R Foot pitch
// 10.L Foot yaw
// 11.L Foot pitch
const PROGMEM uint8_t motion[MAXMN][MAXFN][16]={
	
{  // 0 Stop
  //Sevos 0~11                                       R   G   B  TIME
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,255, 10},	// Frame1
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame2
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame3
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame4
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame5
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame6
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},	// Frame7
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}		// Frame8
},
{  // 1 両手を上げる
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,  0,  0,  0,  7},
  {100, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,  0,255,  0,  7},
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,  0,255,  0,  7},
  { 80, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,  0,  0,  0,  7},
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,  0,255,  0,  7},
  { 90, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,  0,255,  0,  7},
  { 90, 90,  0, 90, 90,180, 90, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0, 90, 90,180, 90, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 2 右手を振る
  { 90, 90,120, 90, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120, 90, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120, 90, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 3 体を左右に振る
  { 90, 70, 90,130, 90, 90, 50, 90, 90, 90, 90, 90,128,128,128, 10},
  { 90,110, 90,130, 90, 90, 50, 90, 90, 90, 90, 90,128,128,128, 10},
  { 90, 70, 90,130, 90, 90, 50, 90, 90, 90, 90, 90,128,128,128, 10},
  { 90,110, 90,130, 90, 90, 50, 90, 90, 90, 90, 90,128,128,128, 10},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 4 両手を上下
  { 90, 70,120,130, 90,180, 50, 90, 90, 90, 90, 90,255,  0,255,  7},
  { 90,110,  0,130, 90, 60, 50, 90, 90, 90, 90, 90,255,  0,255,  7},
  { 90, 70,120,130, 90,180, 50, 90, 90, 90, 90, 90,255,  0,255,  7},
  { 90,110,  0,130, 90, 60, 50, 90, 90, 90, 90, 90,255,  0,255,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 5 停止
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,255, 10},  // Frame1
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame2
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame3
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame4
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame5
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame6
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},  // Frame7
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}   // Frame8
},
{  // 6 両手を上げる
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,255,255,  0,  7},
  {100, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 80, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120, 90, 90, 60, 90, 90, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,120,130,110, 60, 50, 70, 90, 90, 90, 90,255,255,  0,  7},
  { 90, 90,  0, 90, 90,180, 90, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0, 90, 90,180, 90, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 7 両手を広げる
  {110, 90,120, 90,110, 60, 90, 70, 90, 90, 90, 90,  0,128,  0,  3},
  {110, 90,120, 90,110, 60, 90, 70, 90, 90, 90, 90,  0,128,  0,  3},
  {110, 90,120, 90,110, 60, 90, 70, 90, 90, 90, 90,  0,128,  0,  3},
  {110, 90,120, 90,110, 60, 90, 70, 90, 90, 90, 90,  0,128,  0,  3},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 8 両手を上下に振る
  { 90, 90,120,130, 90, 60, 50, 90, 90, 90, 90, 90,255,  0,  0,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,255,  0,  0,  7},
  { 90, 90,120,130, 90, 60, 50, 90, 90, 90, 90, 90,255,  0,  0,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,255,  0,  0,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 9 両手をぶらぶら
  { 70, 90, 30,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  { 90, 90,  0,130, 90,150, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  {110, 90, 30,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  { 90, 90,  0,130, 90,150, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
},
{  // 10 顔を左右に振る
  { 70, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  { 70, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  {110, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  {110, 90,120,130, 90,180, 50, 90, 90, 90, 90, 90,  0,255,255,  7},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0},
  { 90, 90,  0,130, 90,180, 50, 90, 90, 90, 90, 90,  0,  0,  0,  0}
}
};

// 表情（8x8LED：LEDの左から縦1ラインを1Byteづつ）
const PROGMEM uint8_t eyesTbl[EMO_MAX][EYE_MAX][8]={
    {   // 0 真顔
        {0x00, 0x02, 0x02, 0x1A, 0x3E, 0x1E, 0x02, 0x02},       // 左目
        {0x02, 0x02, 0x1E, 0x3E, 0x1A, 0x02, 0x02, 0x00}        // 右目
    },
    {   // 1 ハート
        {0x0C, 0x1E, 0x3E, 0x7C, 0x7C, 0x3E, 0x1E, 0x0C},
        {0x0C, 0x1E, 0x3E, 0x7C, 0x7C, 0x3E, 0x1E, 0x0C}
    },
    {   // 2 怒
        {0x02, 0x04, 0x0C, 0x18, 0x30, 0x60, 0x30, 0x18},
        {0x18, 0x30, 0x60, 0x30, 0x18, 0x0C, 0x04, 0x02}
    },
    {   // 3 哀
        {0x00, 0x08, 0x08, 0x04, 0x1C, 0x3E, 0x1B, 0x00},
        {0x00, 0x1B, 0x3E, 0x1C, 0x04, 0x08, 0x08, 0x00}
    },
    {   // 4 楽
        {0x00, 0x18, 0x04, 0x02, 0x02, 0x02, 0x04, 0x18},
        {0x18, 0x04, 0x02, 0x02, 0x02, 0x04, 0x18, 0x00}
    },
    {   // 5 驚
        {0x00, 0x00, 0x3C, 0x42, 0x5A, 0x42, 0x3C, 0x00},
        {0x00, 0x3C, 0x42, 0x5A, 0x42, 0x3C, 0x00, 0x00}
    },
    {   // 6 睡眠
        {0x00, 0x10, 0x20, 0x20, 0x20, 0x20, 0x20, 0x10},
        {0x10, 0x20, 0x20, 0x20, 0x20, 0x20, 0x10, 0x00}
    },
    {   // 7 睡眠まばたき
        {0xE2, 0xB2, 0x9A, 0x8E, 0x00, 0xC8, 0xA8, 0x98},
        {0xC8, 0xA8, 0x98, 0x00, 0x80, 0x00, 0x80, 0x00}
    },
    {   // 8 またばき
        {0x00, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10},
        {0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00}
    }
};

// 動作と表情の対応テーブル
const PROGMEM uint8_t mortionToEye[13] ={
    EMO_NORMAL,         // #M0
    EMO_HAPPINESS,      // #M1
    EMO_SADNESS,        // #M2
    EMO_NORMAL,         // #M3
    EMO_HEART,          // #M4
    EMO_SLEEP1,         // #M5
    EMO_HEART,          // #M6
    EMO_SURPRISE,       // #M7
    EMO_ANGER,          // #M8
    EMO_SADNESS,        // #M9
    EMO_NORMAL,         // #N0
    EMO_BLINK,          // BLINK
    EMO_SLEEP2          // Zzz
};

